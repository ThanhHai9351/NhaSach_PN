@model List<NhaSachPN.Models.Product>
@using NhaSachPN.Models;
@{
    CompanyDBContext db = new CompanyDBContext();
    List<Category> categories = db.Categories.ToList();
    List<Author> authors = db.Authors.ToList();
    List<Publisher> publishers = db.Publishers.ToList();
}
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}

<div class="p-3 row main" style="border: 1px solid #cdcdcd">
    <div class="col-md-3 mt-3">
        <nav class="nav bg-success flex-column">
            @foreach (var item in categories)
            {
                <a class="text-white nav-link" href="/Product/Index?rangePrice=@ViewBag.PRICE&page=@ViewBag.Page&cateID=@item.ID">@item.CategoryName</a>
            }
            <div class="btn-group dropend">
                <button type="button" class="btn text-start text-white dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Tác Giả
                </button>
                <ul class="dropdown-menu bg-success">
                    @foreach (var item in authors)
                    {
                        <li><a class="dropdown-item" href="/Product/Index?rangePrice=@ViewBag.PRICE&page=@ViewBag.Page&authorID=@item.ID">@item.AuthorName</a></li>
                    }
                </ul>
            </div>
            <div class="btn-group dropend">
                <button type="button" class="btn text-start text-white dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Nhà Xuất Bản
                </button>
                <ul class="dropdown-menu bg-success">
                    @foreach (var item in publishers)
                    {
                        <li><a class="dropdown-item" href="/Product/Index?rangePrice=@ViewBag.PRICE&page=@ViewBag.Page&publisherID=@item.ID">@item.PublisherName</a></li>
                    }
                </ul>
            </div>
        </nav>
        <h5 class="mt-3 mb-3">LỌC THEO GIÁ</h5>
        <form class="mx-3" method="get">
            <label for="rangeInput">GIÁ :  </label>
            <input type="range" id="rangeInput" min="0" max="@ViewBag.MAX" value="@ViewBag.MAX" oninput="updateTextInput(this.value);">
            <input style="border-radius: 5px" type="text" name="rangePrice" id="textInput" value="@ViewBag.PRICE">
            <button type="submit" class="btn btn-secondary m-2">Filter</button>
        </form>
    </div>
    <div class="col-md-9">
        <div class="mt-3">
            <h3 class="">Sản Phẩm</h3>
            <div class="dropdown">
                <button class="btn btn-info dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Sắp xếp
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="/Product/Index?page=@ViewBag.Page&sortPrice=1">Giá tăng dần</a></li>
                    <li><a class="dropdown-item" href="/Product/Index?page=@ViewBag.Page&sortPrice=2">Giá giảm dần</a></li>
                    <li><a class="dropdown-item" href="/Product/Index?page=@ViewBag.Page&sortName=1">Tên tăng dần</a></li>
                    <li><a class="dropdown-item" href="/Product/Index?page=@ViewBag.Page&sortName=2">Tên giảm dần</a></li>
                    <li><a class="dropdown-item" href="/Product/Index?page=@ViewBag.Page&sortNew=1">Sản phẩm mới</a></li>
                </ul>
            </div>
            <hr>
            <div class="row mx-2">
                @foreach (var item in Model)
                {
                    <div class="card card-product col-md-3 m-4" style="width: 15rem; height: 26rem">
                        <img src="@item.Image" class="card-img-top" alt="...">
                        <div class="card-body">
                            @if (@item.ProductName.Length > 16)
                            {
                                <a href="/Product/Detail/@item.ProductID" style="text-decoration: none; color: #000">
                                    <h6 class="card-title">@item.ProductName.Substring(0, 16) ...</h6>
                                </a>
                            }
                            else
                            {
                                <a href="/Product/Detail/@item.ProductID" style="text-decoration: none; color: #000">
                                    <h6 class="card-title">@item.ProductName</h6>
                                </a>
                            }
                            <p class="card-text text-danger">@item.Price đ</p>
                            <a href="#" class="btn btn-warning text-white w-100 h-25">CHỌN MUA</a>
                            <a href="/Favourite/Create/@item.ProductID">
                                <i class="btn btn-outline-danger fa-solid fa-heart mt-2"></i>
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    @{
        int prevPage = ViewBag.Page - 1;
        int nextPage = ViewBag.Page + 1;
        if (prevPage < 0)
        {
            prevPage = 1;
        }
        if (nextPage > ViewBag.SoTrang)
        {
            nextPage = ViewBag.SoTrang;
        }
    }
    @if (ViewBag.SortPrice != 0)
    {
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="/Product/Index?sortPrice=@ViewBag.SortPrice&page=@prevPage">Prev</a>
            </li>
            @for (int i = 1; i <= ViewBag.SoTrang; i++)
            {
                if (i == ViewBag.Page)
                {
                    <li class="page-item">
                        <a class="page-link active " href="/Product/Index?sortPrice=@ViewBag.SortPrice&page=@i">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link " href="/Product/Index?sortPrice=@ViewBag.SortPrice&page=@i">@i</a>
                    </li>
                }
            }
            <li class="page-item">
                <a class="page-link active" href="/Product/Index?sortPrice=@ViewBag.SortPrice&page=@nextPage">Next</a>
            </li>
        </ul>
    }
    else if (ViewBag.SortName != 0)
    {
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="/Product/Index?sortPrice=@ViewBag.SortName&page=@prevPage">Prev</a>
            </li>
            @for (int i = 1; i <= ViewBag.SoTrang; i++)
            {
                if (i == ViewBag.Page)
                {
                    <li class="page-item">
                        <a class="page-link active " href="/Product/Index?sortPrice=@ViewBag.SortName&page=@i">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link " href="/Product/Index?sortPrice=@ViewBag.SortName&page=@i">@i</a>
                    </li>
                }
            }
            <li class="page-item">
                <a class="page-link active" href="/Product/Index?sortPrice=@ViewBag.SortName&page=@nextPage">Next</a>
            </li>
        </ul>
    }
    else if (ViewBag.SortNew != 0)
    {
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="/Product/Index?sortPrice=@ViewBag.SortNew&page=@prevPage">Prev</a>
            </li>
            @for (int i = 1; i <= ViewBag.SoTrang; i++)
            {
                if (i == ViewBag.Page)
                {
                    <li class="page-item">
                        <a class="page-link active " href="/Product/Index?sortPrice=@ViewBag.SortNew&page=@i">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link " href="/Product/Index?sortPrice=@ViewBag.SortNew&page=@i">@i</a>
                    </li>
                }
            }
            <li class="page-item">
                <a class="page-link active" href="/Product/Index?sortPrice=@ViewBag.SortNew&page=@nextPage">Next</a>
            </li>
        </ul>
    }
    else
    {
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="/Product/Index?search=@ViewBag.Search&rangePrice=@ViewBag.PRICE&page=@prevPage">Prev</a>
            </li>
            @for (int i = 1; i <= ViewBag.SoTrang; i++)
            {
                if (i == ViewBag.Page)
                {
                    <li class="page-item">
                        <a class="page-link active " href="/Product/Index?search=@ViewBag.Search&rangePrice=@ViewBag.PRICE&page=@i">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link " href="/Product/Index?search=@ViewBag.Search&rangePrice=@ViewBag.PRICE&page=@i">@i</a>
                    </li>
                }
            }
            <li class="page-item">
                <a class="page-link active" href="/Product/Index?search=@ViewBag.Search&rangePrice=@ViewBag.PRICE&page=@nextPage">Next</a>
            </li>
        </ul>
    }
</div>

